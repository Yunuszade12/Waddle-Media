import{s as a,v as l,p as d,f as p,C as m,h as g,e as u,k as h,A as y,D as w,S as c}from"./index-wINcKeif.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();class f{constructor(){this.scene=null,this.camera=null,this.renderer=null,this.workspace=null,this.animationId=null,this.gameContainer=null,window.spriteManager=a,window.variableManager=l,window.projectManager=d}async init(){document.body.classList.add("prod-mode"),await this.initProductionMode()}async initDevelopmentMode(){console.log("Initializing Waddle Engine in Development Mode"),this.gameContainer=document.getElementById("gameContainer"),this.initThreeJS(),this.initBlockly(),this.setupDevelopmentUI(),this.startAnimationLoop(),console.log("Development mode initialized successfully")}async initProductionMode(){console.log("Initializing Waddle Engine in Production Mode"),this.gameContainer=document.getElementById("gameContainer"),this.initThreeJS(),this.setupProductionFileLoading(),this.startAnimationLoop(),console.log("Production mode initialized successfully")}setupProductionFileLoading(){window.loadGameFile=()=>{const t=document.createElement("input");t.type="file",t.accept=".waddle",t.onchange=async o=>{const n=o.target.files[0];n&&await this.loadGameFile(n)},t.click()};const e=document.getElementById("gameContainer");e.addEventListener("dragover",t=>{t.preventDefault(),e.style.opacity="0.7"}),e.addEventListener("dragleave",()=>{e.style.opacity="1"}),e.addEventListener("drop",async t=>{t.preventDefault(),e.style.opacity="1";const o=t.dataTransfer.files[0];o&&o.name.endsWith(".waddle")&&await this.loadGameFile(o)}),window.toggleFullscreen=()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()},window.resetGame=()=>{a.reset(),typeof window.startGame=="function"&&window.startGame()}}async loadGameFile(e){try{const t=document.getElementById("loadingOverlay");t.style.display="flex",await d.loadProject(e),t.style.display="none",console.log("Game loaded successfully")}catch(t){console.error("Failed to load game:",t);const o=document.getElementById("loadingOverlay");o.innerHTML="<p>Failed to load game: "+t.message+"</p>"}}initThreeJS(){this.scene=new p,this.scene.background=new m(8900331);const e=this.gameContainer.clientWidth/this.gameContainer.clientHeight;this.camera=new g(-400*e,400*e,400,-400,.1,1e3),this.camera.position.z=500,this.renderer=new u({antialias:!0}),this.renderer.setSize(this.gameContainer.clientWidth,this.gameContainer.clientHeight),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=h,this.gameContainer.appendChild(this.renderer.domElement);const t=new y(16777215,.8);this.scene.add(t),window.globalAmbientLight=t;const o=new w(16777215,.5);o.position.set(100,100,50),o.castShadow=!0,this.scene.add(o),window.addEventListener("resize",()=>this.handleResize()),a.init(this.scene,this.renderer)}async initBlockly(){}createToolbox(){return{kind:"categoryToolbox",contents:[{kind:"category",name:"Motion",colour:160,contents:[{kind:"block",type:"move_steps"},{kind:"block",type:"turn_right"},{kind:"block",type:"turn_left"},{kind:"block",type:"go_to"},{kind:"block",type:"point_in_direction"},{kind:"block",type:"change_x"},{kind:"block",type:"change_y"},{kind:"block",type:"set_x"},{kind:"block",type:"set_y"}]},{kind:"category",name:"Looks",colour:290,contents:[{kind:"block",type:"switch_costume"},{kind:"block",type:"next_costume"},{kind:"block",type:"change_size"},{kind:"block",type:"set_size"},{kind:"block",type:"show"},{kind:"block",type:"hide"}]},{kind:"category",name:"Events",colour:330,contents:[{kind:"block",type:"when_flag_clicked"},{kind:"block",type:"when_key_pressed"},{kind:"block",type:"when_sprite_clicked"},{kind:"block",type:"broadcast"},{kind:"block",type:"when_i_receive"}]},{kind:"category",name:"Control",colour:210,contents:[{kind:"block",type:"wait"},{kind:"block",type:"repeat"},{kind:"block",type:"forever"},{kind:"block",type:"if"},{kind:"block",type:"if_else"},{kind:"block",type:"wait_until"}]},{kind:"category",name:"Variables",custom:"VARIABLE"},{kind:"category",name:"Logic",colour:210,contents:[{kind:"block",type:"controls_if"},{kind:"block",type:"logic_compare"},{kind:"block",type:"logic_operation"},{kind:"block",type:"logic_boolean"},{kind:"block",type:"logic_null"}]}]}}setupDevelopmentUI(){}setupAssetUploads(){const e=document.getElementById("costumeUpload"),t=document.getElementById("soundUpload");e.addEventListener("change",o=>{const n=o.target.files[0];if(n&&a.activeSprite){const i=new FileReader;i.onload=r=>{a.activeSprite.addCostume(r.target.result,n.name),this.renderAssetPanels()},i.readAsDataURL(n)}}),t.addEventListener("change",o=>{const n=o.target.files[0];if(n&&a.activeSprite){const i=new FileReader;i.onload=r=>{a.activeSprite.addSound(n.name,r.target.result),this.renderAssetPanels()},i.readAsDataURL(n)}})}setupSpriteManagement(){window.addNewSprite=()=>{const e=new c(`Sprite${a.sprites.length+1}`);a.addSprite(e),a.setActiveSprite(e),this.renderSpriteList(),this.renderAssetPanels(),typeof window.updateInspector=="function"&&window.updateInspector()},window.deleteSprite=e=>{const t=a.getSprite(e);t&&(a.removeSprite(t),this.renderSpriteList(),this.renderAssetPanels(),typeof window.updateInspector=="function"&&window.updateInspector())}}setupProjectManagement(){window.saveProject=()=>{d.saveProject()},window.loadProject=()=>{const e=document.createElement("input");e.type="file",e.accept=".waddle",e.onchange=t=>{const o=t.target.files[0];o&&d.loadProject(o)},e.click()}}setupTabs(){window.openTab=(e,t)=>{const o=document.getElementsByClassName("tab-content"),n=document.getElementsByClassName("tab");for(let i=0;i<o.length;i++)o[i].classList.remove("active");for(let i=0;i<n.length;i++)n[i].classList.remove("active");document.getElementById(t).classList.add("active"),e.currentTarget.classList.add("active")}}createInitialSprite(){const e=new c("Sprite1");a.addSprite(e),a.setActiveSprite(e),this.renderSpriteList(),this.renderAssetPanels()}startAnimationLoop(){const e=()=>{this.animationId=requestAnimationFrame(e),a.update(),this.renderer&&this.scene&&this.camera&&this.renderer.render(this.scene,this.camera)};e()}handleResize(){if(!this.camera||!this.renderer||!this.gameContainer)return;const e=this.gameContainer.clientWidth/this.gameContainer.clientHeight;this.camera.isOrthographicCamera&&(this.camera.left=-400*e,this.camera.right=400*e,this.camera.top=400,this.camera.bottom=-400),this.camera.updateProjectionMatrix(),this.renderer.setSize(this.gameContainer.clientWidth,this.gameContainer.clientHeight)}renderSpriteList(){}renderAssetPanels(){}destroy(){this.animationId&&cancelAnimationFrame(this.animationId),this.renderer&&this.renderer.dispose(),a.reset()}}window.toggleGame=()=>{const s=document.getElementById("playBtn");a.isRunning?(a.stop(),s.textContent="▶️ Play",s.classList.remove("playing")):(a.start(),s.textContent="⏸️ Pause",s.classList.add("playing"))};window.stopGame=()=>{a.stop(),a.reset();const s=document.getElementById("playBtn");s.textContent="▶️ Play",s.classList.remove("playing")};window.resetView=()=>{window.engine&&window.engine.camera&&(window.engine.camera.position.set(0,0,500),window.engine.camera.rotation.set(0,0,0))};document.addEventListener("DOMContentLoaded",async()=>{window.engine=new f,await window.engine.init()});
